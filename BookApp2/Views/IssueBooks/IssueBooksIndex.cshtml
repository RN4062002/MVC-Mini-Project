@model Model.StudentsModel

@{
    ViewBag.Title = "StudentsIndex";
    Layout = "";
}


<html>
    <head>
    <title>Students WebPage</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
          rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style>
      
        section {
            display: flex;
        }

        .elements {
            margin-right: 2rem;
        }

        #add {
            margin-left: 91%;
        }

        label {
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1><B>Issue Book </B></h1>
        <hr />
    </div>
    <div class="container" style="margin-bottom:2rem">
        <section>
            <div class="elements">
                <label>Select Student</label>
                @Html.DropDownListFor(m => m.StudentID, new SelectList(Model.StudentsList, "StudentID", "StudentName"), "Select Student", new { @class = "form-control form-select"})
            </div>
            <div class="elements">
                <label>Select Date</label>
                @Html.TextBoxFor(m => m.IssueBookDate, new { @class = "form-control", @Type = "date" })
            </div>

        </section>

        <section>
            <!-- Button trigger modal -->
            <button type="button" id="add" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
                Show Books
            </button>

            <!-- Modal -->
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel"><b>Select Books</b></h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body" id="showBooksList">
                          
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>





    </div>
    <div class="container">
        <table id="tableid" class="table table-bordered  table-responsive ">
            <tr style="background-color:#b5b5b5">
                <th class="text-center d-none">Book ID</th>
                <th class="text-center">Book Name</th>
                <th class="text-center">Publisher Name</th>
                <th class="text-center">Author Name</th>
                <th class="text-center">Quentity</th>
                <th class="text-center">Actions</th>
            </tr>
            <tbody id="tablebody">
@if (Model.StudentID != 0)
{

    foreach (var item in Model.issueBookList)
    {


        <tr align="center">
            <td>
                @item.BookName
            </td>
            <td>
                @item.PublisherName
            </td>
            <td>
                @item.AuthorName
            </td>
            <td>
                @item.Quentity
            </td>
            @*<td>
                <button type="button" id="SelectProductBtn" class="btn btn-info"> Edit</button>
            </td>*@
        </tr>
    }
}


            </tbody>
        </table>
    </div>
    <div class="container">
        <button id="savedata" class="btn btn-outline-success">Save</button>
    </div>

    <script>
        //$(document).ready(function () {
        //    debugger
        //    var StudentID = $('#StudentID').val();
        //    if (StudentID > 0) {
        //        var obj = {StudentID:StudentID}
        //        $.ajax({
        //            url: '/IssueBooks/GetIssueBooksDetails',
        //            method: "GET",
        //            data:obj,
        //            success: function (data) {
        //                issueBookList(data.issueBookList);
        //            },
        //            error: function (err) {
        //                console.log(err);
        //            }
        //        });

        //    }

        //    function issueBookList(data) {
        //        debugger;
        //        var tableBody = $('#tablebody');
        //        tableBody.empty();


        //        $.each(data, function (index, book) {
        //            var row = '<tr>' +
        //            '<td class="text-center">' + book.BookName + '</td>' +
        //            '<td class="text-center">' + book.PublisherName + '</td>' +
        //            '<td class="text-center">' + book.AuthorName + '</td>' +
        //            '<td class="text-center">' + book.Quentity + '</td>' +
        //        '</tr>';
        //            tableBody.append(row);

        //        });
        //    }

           

        //})

        


   


        // Load the book list pop on the screen on add button click.
        $(document).on('click', '#add', function () {

            debugger
            $.ajax({
                url: '/IssueBooks/BookList',
                method: "GET",
                success: function (response) {
                    $('#showBooksList').html(response);
                },
                error: function (err) {
                    console.log(err);
                }
            });
        });

        $(document).on('click', '#savedata', function () {
            let StudentID = $('#StudentID').val();
            let IssueBookDate = $('#IssueBookDate').val();
            var ArrayBookObj = [];

            $('#tablebody').find('tr').each(function (index) {
                ArrayBookObj[index] = {
                    BookID: $(this).find('td').eq(0).text(),
                    Quentity: $(this).find('td > input').val()
                }
            })

            var obj = { StudentID: StudentID, IssueBookDate: IssueBookDate, BookQuentityList: ArrayBookObj };
            console.log(obj);

            if (obj.StudentID && obj.IssueBookDate && obj.BookQuentityList.length > 0) {
                $.ajax({
                    url: '/IssueBooks/Insert',
                    method: "POST",
                    data: obj,
                    success: function (response) {
                        alert("Data Inserted Successfully.");
                    },
                    error: function (err) {
                        console.log(err);
                    }
                });
            } else {
                alert("Some fields are not selected OR Error ");
            }
        });

    </script>
</body>

</html>
